<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Office Chaos Defense</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', cursive;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4);
            background-size: 400% 400%;
            animation: gradientShift 10s ease infinite;
            overflow: hidden;
            height: 100vh;
            touch-action: manipulation;
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .game-container {
            width: 100%;
            height: 100vh;
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .hud {
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            font-size: 14px;
            z-index: 100;
        }

        .hud-item {
            display: flex;
            align-items: center;
            margin: 2px 5px;
        }

        .hud-icon {
            width: 20px;
            height: 20px;
            margin-right: 5px;
            display: inline-block;
        }

        .game-board {
            flex: 1;
            position: relative;
            overflow: hidden;
            background: 
                radial-gradient(circle at 20% 20%, rgba(255,255,255,0.1) 2px, transparent 2px),
                radial-gradient(circle at 80% 80%, rgba(255,255,255,0.1) 2px, transparent 2px);
            background-size: 50px 50px;
        }

        .coffee-machine {
            position: absolute;
            width: 60px;
            height: 60px;
            background: #8B4513;
            border-radius: 10px;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 3px solid #654321;
            animation: coffeeGlow 2s ease-in-out infinite alternate;
            z-index: 50;
        }

        .coffee-machine::before {
            content: '‚òï';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 24px;
        }

        @keyframes coffeeGlow {
            0% { box-shadow: 0 0 10px rgba(139, 69, 19, 0.5); }
            100% { box-shadow: 0 0 20px rgba(139, 69, 19, 1); }
        }

        .tower {
            position: absolute;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            border: 2px solid #333;
        }

        .tower:hover {
            transform: scale(1.1);
        }

        .tower.stapler {
            background: linear-gradient(45deg, #ff4757, #ff3742);
        }

        .tower.paperclip {
            background: linear-gradient(45deg, #3742fa, #2f3542);
        }

        .tower.rubber-band {
            background: linear-gradient(45deg, #2ed573, #1e90ff);
        }

        .enemy {
            position: absolute;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            z-index: 5;
            transition: all 0.1s ease;
        }

        .enemy.karen {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            border: 2px solid #c44569;
        }

        .enemy.intern {
            background: linear-gradient(45deg, #ffa726, #ff9800);
            border: 2px solid #f57c00;
        }

        .enemy.boss {
            background: linear-gradient(45deg, #6c5ce7, #5f3dc4);
            border: 2px solid #4c1d95;
            width: 40px;
            height: 40px;
        }

        .projectile {
            position: absolute;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            z-index: 15;
        }

        .projectile.staple {
            background: #ff4757;
            box-shadow: 0 0 5px #ff4757;
        }

        .projectile.clip {
            background: #3742fa;
            box-shadow: 0 0 5px #3742fa;
        }

        .projectile.band {
            background: #2ed573;
            box-shadow: 0 0 5px #2ed573;
        }

        .controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 100;
        }

        .control-btn {
            padding: 12px 16px;
            background: rgba(0,0,0,0.8);
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
            transition: all 0.3s ease;
            touch-action: manipulation;
        }

        .control-btn:hover, .control-btn:active {
            background: rgba(255,255,255,0.2);
            transform: scale(1.05);
        }

        .control-btn.selected {
            background: #4ecdc4;
            box-shadow: 0 0 15px rgba(78, 205, 196, 0.5);
        }

        .explosion {
            position: absolute;
            pointer-events: none;
            z-index: 20;
        }

        .damage-text {
            position: absolute;
            color: #ff4757;
            font-weight: bold;
            font-size: 16px;
            pointer-events: none;
            z-index: 25;
            animation: damageFloat 1s ease-out forwards;
        }

        @keyframes damageFloat {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-30px); }
        }

        .health-bar {
            position: absolute;
            width: 30px;
            height: 4px;
            background: rgba(255,255,255,0.3);
            top: -8px;
            left: 0;
            border-radius: 2px;
        }

        .health-fill {
            height: 100%;
            background: #2ed573;
            border-radius: 2px;
            transition: width 0.3s ease;
        }

        .wave-announcement {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 20px 40px;
            border-radius: 15px;
            font-size: 24px;
            font-weight: bold;
            z-index: 200;
            animation: waveAnnounce 2s ease-in-out;
        }

        @keyframes waveAnnounce {
            0%, 100% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); }
            50% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .game-over {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            z-index: 300;
        }

        .game-over h2 {
            font-size: 36px;
            margin-bottom: 20px;
            color: #ff4757;
        }

        .restart-btn {
            padding: 15px 30px;
            background: #4ecdc4;
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }

        .restart-btn:hover {
            background: #45b7d1;
            transform: scale(1.05);
        }

        @media (max-width: 480px) {
            .hud {
                font-size: 12px;
                padding: 8px;
            }
            
            .coffee-machine {
                width: 50px;
                height: 50px;
            }
            
            .tower {
                width: 35px;
                height: 35px;
                font-size: 18px;
            }
            
            .control-btn {
                padding: 10px 14px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="hud">
            <div class="hud-item">
                <span class="hud-icon">üí∞</span>
                <span id="money">100</span>
            </div>
            <div class="hud-item">
                <span class="hud-icon">‚ù§Ô∏è</span>
                <span id="lives">10</span>
            </div>
            <div class="hud-item">
                <span class="hud-icon">üåä</span>
                <span>Wave: <span id="wave">1</span></span>
            </div>
            <div class="hud-item">
                <span class="hud-icon">üìä</span>
                <span>Score: <span id="score">0</span></span>
            </div>
        </div>
        
        <div class="game-board" id="gameBoard">
            <div class="coffee-machine" id="coffeeMachine"></div>
        </div>
        
        <div class="controls">
            <button class="control-btn" id="staplerBtn" data-tower="stapler" data-cost="20">üìé Stapler ($20)</button>
            <button class="control-btn" id="paperclipBtn" data-tower="paperclip" data-cost="30">üñáÔ∏è Clip ($30)</button>
            <button class="control-btn" id="rubberBandBtn" data-tower="rubber-band" data-cost="40">üéØ Band ($40)</button>
            <button class="control-btn" id="startWaveBtn">üöÄ Start Wave</button>
        </div>
    </div>

    <script>
        class Game {
            constructor() {
                this.money = 100;
                this.lives = 10;
                this.wave = 1;
                this.score = 0;
                this.selectedTower = null;
                this.towers = [];
                this.enemies = [];
                this.projectiles = [];
                this.waveInProgress = false;
                this.gameRunning = true;
                
                this.audioContext = null;
                this.setupAudio();
                this.setupEventListeners();
                this.gameLoop();
            }
            
            setupAudio() {
                try {
                    this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
                } catch (e) {
                    console.log('Audio not supported');
                }
            }
            
            playSound(frequency, duration, type = 'sine') {
                if (!this.audioContext) return;
                
                const oscillator = this.audioContext.createOscillator();
                const gainNode = this.audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(this.audioContext.destination);
                
                oscillator.frequency.setValueAtTime(frequency, this.audioContext.currentTime);
                oscillator.type = type;
                
                gainNode.gain.setValueAtTime(0.1, this.audioContext.currentTime);
                gainNode.gain.exponentialRampToValueAtTime(0.01, this.audioContext.currentTime + duration);
                
                oscillator.start(this.audioContext.currentTime);
                oscillator.stop(this.audioContext.currentTime + duration);
            }
            
            setupEventListeners() {
                document.getElementById('gameBoard').addEventListener('click', (e) => {
                    if (this.selectedTower && e.target.id === 'gameBoard') {
                        this.placeTower(e.clientX - e.target.offsetLeft, e.clientY - e.target.offsetTop);
                    }
                });
                
                document.querySelectorAll('[data-tower]').forEach(btn => {
                    btn.addEventListener('click', () => {
                        const tower = btn.dataset.tower;
                        const cost = parseInt(btn.dataset.cost);
                        
                        if (this.money >= cost) {
                            this.selectedTower = { type: tower, cost };
                            document.querySelectorAll('.control-btn').forEach(b => b.classList.remove('selected'));
                            btn.classList.add('selected');
                        } else {
                            this.playSound(200, 0.2, 'sawtooth');
                        }
                    });
                });
                
                document.getElementById('startWaveBtn').addEventListener('click', () => {
                    if (!this.waveInProgress) {
                        this.startWave();
                    }
                });
            }
            
            placeTower(x, y) {
                const board = document.getElementById('gameBoard');
                const rect = board.getBoundingClientRect();
                const adjustedX = x - rect.left;
                const adjustedY = y - rect.top;
                
                // Check if placement is valid (not too close to coffee machine or other towers)
                const coffeeMachine = document.getElementById('coffeeMachine');
                const coffeeRect = coffeeMachine.getBoundingClientRect();
                const boardRect = board.getBoundingClientRect();
                
                const coffeeCenterX = (coffeeRect.left + coffeeRect.width / 2) - boardRect.left;
                const coffeeCenterY = (coffeeRect.top + coffeeRect.height / 2) - boardRect.top;
                
                const distanceFromCoffee = Math.sqrt(
                    Math.pow(adjustedX - coffeeCenterX, 2) + 
                    Math.pow(adjustedY - coffeeCenterY, 2)
                );
                
                if (distanceFromCoffee < 80) {
                    this.playSound(200, 0.2, 'sawtooth');
                    return;
                }
                
                // Check distance from other towers
                for (let tower of this.towers) {
                    const distance = Math.sqrt(
                        Math.pow(adjustedX - tower.x, 2) + 
                        Math.pow(adjustedY - tower.y, 2)
                    );
                    if (distance < 50) {
                        this.playSound(200, 0.2, 'sawtooth');
                        return;
                    }
                }
                
                this.money -= this.selectedTower.cost;
                this.updateHUD();
                
                const tower = {
                    id: Date.now(),
                    type: this.selectedTower.type,
                    x: adjustedX,
                    y: adjustedY,
                    lastShot: 0,
                    range: this.selectedTower.type === 'rubber-band' ? 120 : 80,
                    damage: this.selectedTower.type === 'stapler' ? 25 : this.selectedTower.type === 'paperclip' ? 35 : 50,
                    fireRate: this.selectedTower.type === 'stapler' ? 300 : this.selectedTower.type === 'paperclip' ? 500 : 800
                };
                
                this.towers.push(tower);
                this.createTowerElement(tower);
                this.playSound(400, 0.1, 'triangle');
                
                this.selectedTower = null;
                document.querySelectorAll('.control-btn').forEach(b => b.classList.remove('selected'));
            }
            
            createTowerElement(tower) {
                const towerEl = document.createElement('div');
                towerEl.className = `tower ${tower.type}`;
                towerEl.id = `tower-${tower.id}`;
                towerEl.style.left = (tower.x - 20) + 'px';
                towerEl.style.top = (tower.y - 20) + 'px';
                
                const icons = {
                    'stapler': 'üìå',
                    'paperclip': 'üñáÔ∏è',
                    'rubber-band': 'üéØ'
                };
                
                towerEl.textContent = icons[tower.type];
                document.getElementById('gameBoard').appendChild(towerEl);
            }
            
            startWave() {
                this.waveInProgress = true;
                this.showWaveAnnouncement();
                
                const enemyCount = 5 + (this.wave * 2);
                const enemyTypes = ['karen', 'intern', 'boss'];
                
                for (let i = 0; i < enemyCount; i++) {
                    setTimeout(() => {
                        this.spawnEnemy(enemyTypes[Math.floor(Math.random() * enemyTypes.length)]);
                    }, i * 1000);
                }
                
                setTimeout(() => {
                    this.waveInProgress = false;
                    this.wave++;
                    this.updateHUD();
                }, enemyCount * 1000 + 5000);
            }
            
            showWaveAnnouncement() {
                const announcement = document.createElement('div');
                announcement.className = 'wave-announcement';
                announcement.textContent = `Wave ${this.wave} - Office Chaos Incoming!`;
                document.body.appendChild(announcement);
                
                this.playSound(600, 0.5, 'square');
                
                setTimeout(() => {
                    announcement.remove();
                }, 2000);
            }
            
            spawnEnemy(type) {
                const board = document.getElementById('gameBoard');
                const boardRect = board.getBoundingClientRect();
                
                // Spawn from random edge
                const edges = ['top', 'right', 'bottom', 'left'];
                const edge = edges[Math.floor(Math.random() * edges.length)];
                
                let x, y;
                switch(edge) {
                    case 'top':
                        x = Math.random() * boardRect.width;
                        y = 0;
                        break;
                    case 'right':
                        x = boardRect.width;
                        y = Math.random() * boardRect.height;
                        break;
                    case 'bottom':
                        x = Math.random() * boardRect.width;
                        y = boardRect.height;
                        break;
                    case 'left':
                        x = 0;
                        y = Math.random() * boardRect.height;
                        break;
                }
                
                const enemy = {
                    id: Date.now() + Math.random(),
                    type: type,
                    x: x,
                    y: y,
                    health: type === 'karen' ? 50 : type === 'intern' ? 30 : 100,
                    maxHealth: type === 'karen' ? 50 : type === 'intern' ? 30 : 100,
                    speed: type === 'karen' ? 1 : type === 'intern' ? 1.5 : 0.8,
                    reward: type === 'karen' ? 15 : type === 'intern' ? 10 : 30
                };
                
                this.enemies.push(enemy);
                this.createEnemyElement(enemy);
            }
            
            createEnemyElement(enemy) {
                const enemyEl = document.createElement('div');
                enemyEl.className = `enemy ${enemy.type}`;
                enemyEl.id = `enemy-${enemy.id}`;
                enemyEl.style.left = (enemy.x - 15) + 'px';
                enemyEl.style.top = (enemy.y - 15) + 'px';
                
                const icons = {
                    'karen': 'üò†',
                    'intern': 'ü§ì',
                    'boss': 'üëî'
                };
                
                enemyEl.textContent = icons[enemy.type];
                
                // Add health bar
                const healthBar = document.createElement('div');
                healthBar.className = 'health-bar';
                const healthFill = document.createElement('div');
                healthFill.className = 'health-fill';
                healthBar.appendChild(healthFill);
                enemyEl.appendChild(healthBar);
                
                document.getElementById('gameBoard').appendChild(enemyEl);
            }
            
            gameLoop() {
                if (!this.gameRunning) return;
                
                this.updateEnemies();
                this.updateTowers();
                this.updateProjectiles();
                this.checkCollisions();
                
                requestAnimationFrame(() => this.gameLoop());
            }
            
            updateEnemies() {
                const coffeeMachine = document.getElementById('coffeeMachine');
                const coffeeRect = coffeeMachine.getBoundingClientRect();
                const board = document.getElementById('gameBoard');
                const boardRect = board.getBoundingClientRect();
                
                const coffeeCenterX = (coffeeRect.left + coffeeRect.width / 2) - boardRect.left;
                const coffeeCenterY = (coffeeRect.top + coffeeRect.height / 2) - boardRect.top;
                
                this.enemies = this.enemies.filter(enemy => {
                    if (enemy.health <= 0) {
                        this.money += enemy.reward;
                        this.score += enemy.reward * 10;
                        this.updateHUD();
                        this.removeEnemyElement(enemy.id);
                        this.playSound(300, 0.1, 'triangle');
                        return false;
                    }
                    
                    // Move towards coffee machine
                    const dx = coffeeCenterX - enemy.x;
                    const dy = coffeeCenterY - enemy.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 30) {
                        // Reached coffee machine
                        this.lives--;
                        this.updateHUD();
                        this.removeEnemyElement(enemy.id);
                        this.playSound(150, 0.3, 'sawtooth');
                        
                        if (this.lives <= 0) {
                            this.gameOver();
                        }
                        return false;
                    }
                    
                    enemy.x += (dx / distance) * enemy.speed;
                    enemy.y += (dy / distance) * enemy.speed;
                    
                    const enemyEl = document.getElementById(`enemy-${enemy.id}`);
                    if (enemyEl) {
                        enemyEl.style.left = (enemy.x - 15) + 'px';
                        enemyEl.style.top = (enemy.y - 15) + 'px';
                        
                        // Update health bar
                        const healthFill = enemyEl.querySelector('.health-fill');
                        if (healthFill) {
                            healthFill.style.width = (enemy.health / enemy.maxHealth * 100) + '%';
                        }
                    }
                    
                    return true;
                });
            }
            
            updateTowers() {
                const currentTime = Date.now();
                
                this.towers.forEach(tower => {
                    if (currentTime - tower.lastShot > tower.fireRate) {
                        // Find nearest enemy in range
                        let nearestEnemy = null;
                        let nearestDistance = Infinity;
                        
                        this.enemies.forEach(enemy => {
                            const distance = Math.sqrt(
                                Math.pow(enemy.x - tower.x, 2) + 
                                Math.pow(enemy.y - tower.y, 2)
                            );
                            
                            if (distance <= tower.range && distance < nearestDistance) {
                                nearestEnemy = enemy;
                                nearestDistance = distance;
                            }
                        });
                        
                        if (nearestEnemy) {
                            this.shootProjectile(tower, nearestEnemy);
                            tower.lastShot = currentTime;
                        }
                    }
                });
            }
            
            shootProjectile(tower, target) {
                const projectile = {
                    id: Date.now() + Math.random(),
                    x: tower.x,
                    y: tower.y,
                    targetX: target.x,
                    targetY: target.y,
                    speed: 5,
                    damage: tower.damage,
                    type: tower.type
                };
                
                this.projectiles.push(projectile);
                this.createProjectileElement(projectile);
                this.playSound(800, 0.05, 'square');
            }
            
            createProjectileElement(projectile) {
                const projectileEl = document.createElement('div');
                projectileEl.className = `projectile ${projectile.type === 'stapler' ? 'staple' : projectile.type === 'paperclip' ? 'clip' : 'band'}`;
                projectileEl.id = `projectile-${projectile.id}`;
                projectileEl.style.left = projectile.x + 'px';
                projectileEl.style.top = projectile.y + 'px';
                
                document.getElementById('gameBoard').appendChild(projectileEl);
            }
            
            updateProjectiles() {
                this.projectiles = this.projectiles.filter(projectile => {
                    const dx = projectile.targetX - projectile.x;
                    const dy = projectile.targetY - projectile.y;
                    const distance = Math.sqrt(dx * dx + dy * dy);
                    
                    if (distance < 10) {
                        this.removeProjectileElement(projectile.id);
                        return false;
                    }
                    
                    projectile.x += (dx / distance) * projectile.speed;
                    projectile.y += (dy / distance) * projectile.speed;
                    
                    const projectileEl = document.getElementById(`projectile-${projectile.id}`);
                    if (projectileEl) {
                        projectileEl.style.left = projectile.x + 'px';
                        projectileEl.style.top = projectile.y + 'px';
                    }
                    
                    return true;
                });
            }
            
            checkCollisions() {
                this.projectiles.forEach(projectile => {
                    this.enemies.forEach(enemy => {
                        const distance = Math.sqrt(
                            Math.pow(enemy.x - projectile.x, 2) + 
                            Math.pow(enemy.y - projectile.y, 2)
                        );
                        
                        if (distance < 20) {
                            enemy.health -= projectile.damage;
                            this.createDamageText(enemy.x, enemy.y, projectile.damage);
                            this.createExplosion(enemy.x, enemy.y);
                            this.removeProjectileElement(projectile.id);
                            
                            // Remove projectile from array
                            const projIndex = this.projectiles.indexOf(projectile);
                            if (projIndex > -1) {
                                this.projectiles.splice(projIndex, 1);
                            }
                        }
                    });
                });
            }
            
            createDamageText(x, y, damage) {
                const damageEl = document.createElement('div');
                damageEl.className = 'damage-text';
                damageEl.textContent = `-${damage}`;
                damageEl.style.left = x + 'px';
                damageEl.style.top = y + 'px';
                
                document.getElementById('gameBoard').appendChild(damageEl);
                
                setTimeout(() => {
                    damageEl.remove();
                }, 1000);
            }
            
            createExplosion(x, y) {
                const explosion = document.createElement('div');
                explosion.className = 'explosion';
                explosion.style.left = x + 'px';
                explosion.style.top = y + 'px';
                explosion.textContent = 'üí•';
                explosion.style.fontSize = '20px';
                explosion.style.animation = 'damageFloat 0.5s ease-out forwards';
                
                document.getElementById('gameBoard').appendChild(explosion);
                
                setTimeout(() => {
                    explosion.remove();
                }, 500);
            }
            
            removeEnemyElement(id) {
                const el = document.getElementById(`enemy-${id}`);
                if (el) el.remove();
            }
            
            removeProjectileElement(id) {
                const el = document.getElementById(`projectile-${id}`);
                if (el) el.remove();
            }
            
            updateHUD() {
                document.getElementById('money').textContent = this.money;
                document.getElementById('lives').textContent = this.lives;
                document.getElementById('wave').textContent = this.wave;
                document.getElementById('score').textContent = this.score;
            }
            
            gameOver() {
                this.gameRunning = false;
                
                const gameOverEl = document.createElement('div');
                gameOverEl.className = 'game-over';
                gameOverEl.innerHTML = `
                    <h2>‚òï COFFEE CRISIS! ‚òï</h2>
                    <p>The office workers have overwhelmed your coffee machine!</p>
                    <p>Wave Reached: ${this.wave}</p>
                    <p>Final Score: ${this.score}</p>
                    <button class="restart-btn" onclick="location.reload()">Try Again</button>
                `;
                
                document.body.appendChild(gameOverEl);
                this.playSound(200, 1, 'sawtooth');
            }
        }
        
        // Start the game when page loads
        window.addEventListener('load', () => {
            // Resume audio context on first user interaction
            document.addEventListener('click', function resumeAudio() {
                if (game.audioContext && game.audioContext.state === 'suspended') {
                    game.audioContext.resume();
                }
                document.removeEventListener('click', resumeAudio);
            });
            
            const game = new Game();
            window.game = game; // Make game accessible globally
        });
    </script>
</body>
</html>